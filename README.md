# PDF-A-go-slim

A browser-based PDF optimization tool that reduces file size entirely client-side. No uploads, no accounts, no file size limits beyond available RAM.

## Why I built this

This project grew out of [PDF-A-go-go](https://github.com/khawkins98/PDF-A-go-go), an embeddable PDF viewer for the web. While building a small showcase PDF for its demo page, I hit a problem that turns out to be universal.

A clean 32 KB PDF generated by ReportLab was opened in Adobe Illustrator for a minor layout tweak. Illustrator saved it back at 198 KB — a 6x increase for a cosmetic change. It had silently embedded full TrueType copies of Helvetica and Courier (standard fonts every PDF reader already has), injected layers of application-private metadata, and duplicated font references in multiple formats.

I tried the obvious tools:

- **Ghostscript** got it to 96 KB but couldn't strip the redundant standard font embeddings
- **qpdf** barely moved the needle (194 KB) — it optimizes structure but doesn't touch content
- **iLovePDF** got it to 62 KB — decent, but requires uploading to a third-party server
- **Smallpdf** — paywalled before you can even try

Every optimization technique here is well-documented individually, but no tool put them all together in the browser where files stay private and the tool is free. So I built one.

## Features

- **Drag-and-drop** — drop one or more PDFs, use the file picker, or drag a sample PDF icon from the desktop
- **8 optimization passes** — stream recompression, image recompression, standard font unembedding, font subsetting, object deduplication, font deduplication, metadata stripping, unreferenced object removal
- **Optimization presets** — Lossless (default), Web (lossy, 75% quality), Print (lossy, 92% quality), Super Compress (lossy, 50% quality, 72 DPI — ideal for AI ingestion)
- **Advanced controls** — lossy/lossless toggle, image quality slider, font unembedding and subsetting checkboxes
- **Object inspector** — before/after breakdown of PDF objects by category with proportional size bars and per-item diffs
- **Accessibility palette** — dedicated floating palette with pass/fail trait checklist (tagged, structure tree, document title, display title, language, PDF/A, PDF/UA), lightweight audits (ToUnicode coverage, image alt text, structure tree depth), and links to external validators
- **PDF/A and accessibility aware** — auto-detects PDF/A conformance and tagged PDFs; preserves embedded fonts, XMP metadata, and structure trees that conformance requires
- **Privacy-first** — files never leave your browser; all processing runs in a Web Worker
- **Batch capable** — optimize multiple PDFs at once with individual or bulk download
- **Debug mode** — add `?debug` to the URL for per-pass timing and image conversion details
- **Benchmark tested** — 57 tests verify compression, asset stripping, and accessibility preservation ([results](docs/benchmark-results.md))

## A note on font subsetting

Font subsetting is **off by default**. We fixed a rendering issue where subsetting could cause text to become invisible in certain fonts (cmap-less CIDFontType2 and already-subsetted simple fonts), but we continue to monitor for edge cases. You can enable font subsetting in the Advanced Settings panel.

## A note on accessibility

The optimizer auto-detects PDF/A conformance (ISO 19005), PDF/UA (ISO 14289), and tagged PDFs. When it finds them, it disables font unembedding and XMP stripping to preserve what conformance requires. Structure trees, ToUnicode CMaps, and language tags are carried through.

That said, I haven't fully vetted every edge case. If you're working with accessibility-critical documents, test the output. Contributions and bug reports in this area are welcome.

## Why it looks like that

The tool borrows its visual structure from Mac OS 8 — floating palettes, striped title bars, WindowShade collapse, warm cream surfaces. This is an experiment in whether late-90s desktop paradigms (persistent tool palettes, dense layouts, always-visible information) suit single-purpose browser utilities better than modern minimal convention.

The retro is a thin veneer. Underneath it's a standard Vite app with system fonts, responsive layout, and semantic HTML. See [docs/UI.md](docs/UI.md) for the design rationale.

## Quick Start

```bash
npm install
npm run dev
```

Open `http://localhost:5173`, drop a PDF, and download the optimized version.

## Commands

| Command | Description |
|---------|-------------|
| `npm run dev` | Start Vite dev server |
| `npm run build` | Production build |
| `npm test` | Run all tests and regenerate [benchmark report](docs/benchmark-results.md) |
| `npm run test:watch` | Run tests in watch mode |
| `npm run benchmark` | Regenerate benchmark report only |

## Architecture

```
index.html → src/main.js (UI, drag-and-drop, worker orchestration)
                 ↓
             src/worker.js (Web Worker — off-main-thread processing)
                 ↓
             src/engine/pipeline.js (sequential optimization passes)
                 ↓
             src/engine/optimize/  (8 passes, run in order):
               streams.js      — recompress streams with fflate level 9
               images.js       — JPEG recompression + DPI downsampling
               font-unembed.js — remove embedded base-14 standard fonts
               font-subset.js  — subset fonts via harfbuzzjs WASM
               dedup.js        — hash-based object deduplication
               fonts.js        — consolidate duplicate embedded fonts
               metadata.js     — strip XMP / Illustrator / Photoshop bloat
               unreferenced.js — remove unreachable objects via BFS
```

For detailed technical notes on PDF internals, font handling, and stream decoding, see [docs/learnings.md](docs/learnings.md).

## Built with

- [pdf-lib](https://github.com/Hopding/pdf-lib) — low-level PDF object access (MIT)
- [fflate](https://github.com/101arrowz/fflate) — pure-JS zlib compression (MIT)
- [jpeg-js](https://github.com/jpeg-js/jpeg-js) — pure-JS JPEG encoder (BSD 3-Clause)
- [harfbuzzjs](https://github.com/nicbou/harfbuzzjs) — WASM font subsetting (MIT / Apache 2.0)
- [Vite](https://vitejs.dev/) — build tooling
- [Vitest](https://vitest.dev/) — test runner

## Inspirations and references

**Design:**
- [Apple Macintosh Human Interface Guidelines (1995)](http://interface.free.fr/Archives/Apple_HIGOS8_Guidelines.pdf) — the structural model for floating palettes, title bar chrome, and WindowShade
- [Poolsuite.net](https://poolsuite.net/) — demonstrated that retro charm works with thin borders, warm colors, and generous spacing rather than heavy 3D bevels
- [PostHog (2025 redesign)](https://posthog.com/) — a developer tools company that committed to a full desktop-OS metaphor for their site, built by [@ninepixelgrid](https://x.com/ninepixelgrid/status/1965618996990136539)
- [98.css](https://jdan.github.io/98.css/) — the original CSS bevel technique; we borrowed the idea and simplified to thin 1px borders

**CRT scanline overlay** (composite CSS technique assembled from):
- [Alec Lownes](http://aleclownes.com/2017/02/01/crt-display.html) — documented Lucas Bebber's scanline + RGB sub-pixel gradients and pseudo-random flicker technique
- [Remi Dubourgnoux](https://blogit.michelin.io/hack-it-go-crt/) — repeating-linear-gradient with explicit pixel stops
- [Una Kravets](https://una.im/vignettes) — radial-gradient vignette technique
- [Robert Bottomley](https://blog.webguy.pw/blog/simulating-a-crt-monitor-in-css/) — combined vignette + phosphor glow

**Tools that informed the problem space:**
- [Ghostscript](https://www.ghostscript.com/) — powerful CLI PDF optimizer (AGPL); great at compression, limited at content-level cleanup
- [qpdf](https://github.com/qpdf/qpdf) — structural PDF optimization (Apache 2.0); fast and correct, but doesn't touch fonts or images
- [iLovePDF](https://www.ilovepdf.com/) / [Smallpdf](https://smallpdf.com/) — effective online optimizers, but require file uploads and are paywalled for batch use
- [Squoosh](https://squoosh.app/) — Google's client-side image optimizer; a benchmark for how browser-based tools should feel

**Sound effects:**
- [MacOS Classic Sound Pack v1.5](https://code.google.com/archive/p/stevenjaycohen/downloads) — curated by [Steven Jay Cohen](https://stevenjaycohen.com/journal/macos-classic-sound-pack-v1-4), with Karl Laurent and Ginger Lindsey

**Accessibility checks inspired by:**
- [PDFcheck](https://github.com/jsnmrs/pdfcheck) by Jason Morris ([blog post](https://jasonmorris.com/code/pdfcheck/)) — client-side PDF accessibility checker (MIT); our document title, display title, and marked-status checks were inspired by its approach

## Related projects

- [PDF-A-go-go](https://github.com/khawkins98/PDF-A-go-go) — embeddable PDF viewer for the web (sibling project; this tool's origin story)

## Documentation

- [Benchmark results](docs/benchmark-results.md) — auto-generated compression and accessibility test report
- [UI architecture](docs/UI.md) — design decisions, layout, and window manager details
- [Technical learnings](docs/learnings.md) — PDF internals, font subsetting, stream decoding notes
- [UX improvements](docs/ux-improvements.md) — prioritized backlog of UI/accessibility work

## License

[MIT](LICENSE)
